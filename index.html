<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recursive WebGL Sphere</title>
    <style>
        /* Basic page styling: dark background and centered canvas */
        body { margin: 0; background: #111; color: #eee; }
        #glCanvas { width: 800px; height: 600px; display: block; margin: 20px auto; border: 1px solid #444; }
        #info { text-align: center; font-family: sans-serif; }
    </style>
</head>
<body>
    <!-- Canvas where WebGL will render the recursively subdivided sphere -->
    <canvas id="glCanvas"></canvas>
    <div id="info">
        Use up / down arrow keys to change subdivision level (0 - 6).
    </div>

    <!-- Vertex Shader: uses Blinn-Phong lighting and passes color to fragment shader-->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 aPosition;
        attribute vec3 aNormal;

        uniform mat4 uModelViewMatrix;
        uniform mat4 uProjectionMatrix;
        uniform mat3 uNormalMatrix;

        uniform vec4 uLightPosition;
        uniform vec4 uAmbientProduct;
        uniform vec4 uDiffuseProduct;
        uniform vec4 uSpecularProduct;
        uniform float uShininess;

        varying vec4 vColor;
        varying vec3 vObjectNormal;

        void main(void) {
            vec3 pos = (uModelViewMatrix * aPosition).xyz;
            vec3 N = normalize(uNormalMatrix * aNormal);
            vec3 L = normalize(uLightPosition.xyz - pos);
            vec3 V = normalize(-pos);
            vec3 R = reflect(-L, N);

            // Diffuse term
            float Kd = max(dot(L, N), 0.0);
            vec4 diffuse = Kd * uDiffuseProduct;

            // Specular term
            float Ks = 0.0;
            if (Kd > 0.0) {
                Ks = pow(max(dot(R, V), 0.0), uShininess);
            }
            vec4 specular = Ks * uSpecularProduct;

            // Ambient term
            vec4 ambient = uAmbientProduct;

            vColor = ambient + diffuse + specular;
            vColor.a = 1.0;

            vObjectNormal = normalize(aNormal);

            gl_Position = uProjectionMatrix * uModelViewMatrix * aPosition;
        }
        </script>

        <!-- Fragmeent shader: Combines Blinn-Phong with
        multicolored gradient for rotation visibility-->
        <script id="fragment-shader" type="x-shader/x-fragment">
            precision mediump float;

            varying vec4 vColor;
            varying vec3 vObjectNormal;

            void main(void) {
                vec3 litColor = vColor.rgb;
                
                vec3 n = normalize(vObjectNormal);

                vec3 baseAlbedo = 0.5 * (n + 1.0);

                vec3 finalColor = baseAlbedo * litColor;
                
                gl_FragColor = vec4(finalColor, vColor.a);
            }
        </script>

        <!-- Pulls in main JavaScript file -->
        <script src="sphere.js"></script>
</body>
</html>